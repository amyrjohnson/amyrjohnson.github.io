<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Blog Title]]></title>
  <link href="http://amyrjohnson.github.io/atom.xml" rel="self"/>
  <link href="http://amyrjohnson.github.io/"/>
  <updated>2014-06-27T15:29:12-04:00</updated>
  <id>http://amyrjohnson.github.io/</id>
  <author>
    <name><![CDATA[Amy Johnson]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Making a simple browser game with Sinatra]]></title>
    <link href="http://amyrjohnson.github.io/blog/2014/06/27/making-a-simple-browser-game-with-sinatra/"/>
    <updated>2014-06-27T10:05:43-04:00</updated>
    <id>http://amyrjohnson.github.io/blog/2014/06/27/making-a-simple-browser-game-with-sinatra</id>
    <content type="html"><![CDATA[<p>This paragraph will be some kind of intro</p>

<p>The first step is creating the code that contains the logic of the game. There are a ton of different ways to do this, and Sinatra doesn&rsquo;t care which way you choose. I decided to make a game class, a board class, and a player class. The game class contains the logic pertaining to turns and the running of the game. The board class stores the gameboard as a 3x3 matrix, updates itself with every turn, and determines when the game has ended in a win, loss, or tie. The player class stores the player attributes like name and marker.</p>

<p>The next step is to move the Ruby logic into a Sinatra application. To make things a little easier, I used <a href="https://github.com/ashleygwilliams/ratpack">Ratpack</a>, a Sinatra boilerplate by <a href="http://about.me/ashley_williams">Ashley Williams</a> with activerecord, sqlite, and twitter bootstrap. In the Ratpack schema the models live in the <code>lib</code> directory.</p>

<p>Now we can ignore our tic-tac-toe logic for a little bit and get our pages set up. First we need to define a class that inherits from Sinatra so that we can use all of Sinatra&rsquo;s functionality in our application. Next create the routes. Each page needs a route established by a <code>get</code> statement in order to render.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># app.rb</span>
</span><span class='line'>
</span><span class='line'><span class="k">module</span> <span class="nn">TicTacToeProject</span>
</span><span class='line'>  <span class="k">class</span> <span class="nc">App</span> <span class="o">&lt;</span> <span class="ss">Sinatra</span><span class="p">:</span><span class="ss">:Application</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">#routes</span>
</span><span class='line'>    <span class="n">get</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">erb</span> <span class="ss">:index</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">get</span> <span class="s1">&#39;/play&#39;</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">erb</span> <span class="ss">:play</span>
</span><span class='line'>    <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>The <code>erb :filename</code> statements are telling Sinatra what to render. In this case that&rsquo;s the erb files from my views folder. In order to make a board show up in the browser, I need to display each square from my board in my html, which is easy to do using erb. I chose to format the board as three rows with three columns each, but you could just as easily use a table or some other method.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="c">&lt;!-- views/play.erb --&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;board&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;row center&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;col-md-4&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;h2&gt;</span><span class="err">&lt;</span>%= game.square(0,0) %&gt;<span class="nt">&lt;/h2&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;col-md-4 v&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;h2&gt;</span><span class="err">&lt;</span>%= game.square(0,1) %&gt;<span class="nt">&lt;/h2&gt;</span>
</span><span class='line'>   <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;col-md-4&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;h2&gt;</span><span class="err">&lt;</span>%= game.square(0,2) %&gt;<span class="nt">&lt;/h2&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The only problem is, this erb file has no idea what <code>game</code> is. I need to pass the instance of my game class in my route in order for my views to render it. That looks something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># app.rb</span>
</span><span class='line'>
</span><span class='line'><span class="k">module</span> <span class="nn">TicTacToeProject</span>
</span><span class='line'>  <span class="k">class</span> <span class="nc">App</span> <span class="o">&lt;</span> <span class="ss">Sinatra</span><span class="p">:</span><span class="ss">:Application</span>
</span><span class='line'>
</span><span class='line'>    <span class="vc">@@game</span> <span class="o">||=</span> <span class="no">PlayGame</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">#routes</span>
</span><span class='line'>    <span class="n">get</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
</span><span class='line'>      <span class="vi">@game</span> <span class="o">=</span> <span class="vc">@@game</span>
</span><span class='line'>      <span class="n">erb</span> <span class="ss">:index</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">get</span> <span class="s1">&#39;/play&#39;</span> <span class="k">do</span>
</span><span class='line'>      <span class="vi">@game</span> <span class="o">=</span> <span class="vc">@@game</span>
</span><span class='line'>      <span class="n">erb</span> <span class="ss">:play</span>
</span><span class='line'>    <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Once I&rsquo;ve created views and routes for all my pages I&rsquo;m most of the way there, but how do I get input from the user to allow them to play the game? One simple way to receive input from a user and store it for access later is to include a form in the view.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="c">&lt;!-- views/play.erb --&gt;</span>
</span><span class='line'>
</span><span class='line'>      <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;/move&quot;</span> <span class="na">method=</span><span class="s">&quot;get&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">name=</span><span class="s">&quot;move&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;Submit&quot;</span> <span class="na">value=</span><span class="s">&quot;Play&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/form&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The text input of the form, which I named &ldquo;move&rdquo;, is stored in Sinatra&rsquo;s params hash automatically. I can access whatever the user typed elsewhere in my program using the <code>params[:move]</code> variable. Now I can update the board with the player&rsquo;s move before loading the erb in my route.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># app.rb</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">get</span> <span class="s1">&#39;/move&#39;</span> <span class="k">do</span>
</span><span class='line'>      <span class="vc">@@game</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="s2">&quot;move&quot;</span><span class="o">]</span><span class="p">)</span> <span class="c1">#updates the gameboard with the player&#39;s chosen move</span>
</span><span class='line'>      <span class="vi">@game</span> <span class="o">=</span> <span class="vc">@@game</span>
</span><span class='line'>      <span class="n">erb</span> <span class="ss">:move</span>
</span><span class='line'>    <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p> We&rsquo;re almost done! Now we can get a move from the player, update the board, and render a page displaying the updated board. However, if you were to run the code as is you&rsquo;d soon discover a problem. Every time the player moves the board will update, but when the player goes to make a second move they&rsquo;ll find their previous move has been erased and the board is blank! The reason for this is that every time the Sinatra application is run it generates a new instance of the class App or something. So every time it runs, it creates a new instance of the PlayGame class.</p>

<p> I fixed this problem using sessions. Storing the instance of the PlayGame class as a session variable allows you to persist it until a new game is started. Instead of having the class variable <code>@@game</code>, the game session is now stored in <code>session[:game]</code>. Sessions are disabled in Sinatra by default, but they can be included just by adding <code>enable:sessions</code> at the top of your file.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># app.rb</span>
</span><span class='line'>
</span><span class='line'> <span class="n">enable</span> <span class="ss">:sessions</span>
</span><span class='line'>
</span><span class='line'> <span class="n">get</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">session</span><span class="o">[</span><span class="ss">:game</span><span class="o">]</span> <span class="o">=</span> <span class="no">PlayGame</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>      <span class="n">erb</span> <span class="ss">:index</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">get</span> <span class="s1">&#39;/move&#39;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">session</span><span class="o">[</span><span class="ss">:game</span><span class="o">].</span><span class="n">play</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="s2">&quot;move&quot;</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@game</span> <span class="o">=</span> <span class="n">session</span><span class="o">[</span><span class="ss">:game</span><span class="o">]</span>
</span><span class='line'>    <span class="n">erb</span> <span class="ss">:move</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>And now we have a working game! Fix up the views with twitter bootstrap, and we&rsquo;re all done. You can check out my finished version at <a href="amystictactoegame.herokuapp.com">amystictactoegame.herokuapp.com</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Matrices in Ruby]]></title>
    <link href="http://amyrjohnson.github.io/blog/2014/06/11/my-first-post-on-octopress/"/>
    <updated>2014-06-11T13:05:08-04:00</updated>
    <id>http://amyrjohnson.github.io/blog/2014/06/11/my-first-post-on-octopress</id>
    <content type="html"><![CDATA[<p>Ruby has a matrix library that can be used to do simple linear algebra. The Matrix class defines useful methods like transpose, rank, and determinant. This is nice, because a lot of practical problems can be formulated in terms of linear algebra. Say that we have the following data about recently sold homes:</p>

<table>
<thead>
<tr>
<th> Table  </th>
<th align="left"> Square Footage </th>
<th align="left"> # Bathrooms   </th>
<th align="left"> Price </th>
</tr>
</thead>
<tbody>
<tr>
<td>House 0 </td>
<td align="left">4000            </td>
<td align="left">3              </td>
<td align="left">400000 </td>
</tr>
<tr>
<td>House 1 </td>
<td align="left">3000            </td>
<td align="left">2              </td>
<td align="left">310000 </td>
</tr>
<tr>
<td>House 2 </td>
<td align="left">3800            </td>
<td align="left">3              </td>
<td align="left">375000  </td>
</tr>
<tr>
<td>House 3 </td>
<td align="left">3200            </td>
<td align="left">2              </td>
<td align="left">315000 </td>
</tr>
<tr>
<td>House 4 </td>
<td align="left">3542            </td>
<td align="left">4              </td>
<td align="left">350000 </td>
</tr>
<tr>
<td>House 5 </td>
<td align="left">2348            </td>
<td align="left">2              </td>
<td align="left">250000 </td>
</tr>
<tr>
<td>House 6 </td>
<td align="left">2987            </td>
<td align="left">3              </td>
<td align="left">300000 </td>
</tr>
<tr>
<td>House 7 </td>
<td align="left">4300            </td>
<td align="left">4              </td>
<td align="left">450000 </td>
</tr>
<tr>
<td>House 8 </td>
<td align="left">3342            </td>
<td align="left">4              </td>
<td align="left">360000 </td>
</tr>
<tr>
<td>House 9 </td>
<td align="left">3000            </td>
<td align="left">3              </td>
<td align="left">320000 </td>
</tr>
</tbody>
</table>


<br>


<p>The data has, for each house, the square footage, number of bathrooms, and the price that the house sold for. If you wanted to predict what price another house (not in this data set) might sell for, and you knew its size and bathroom count, you could use the Matrix class to perform a linear regression on the data.</p>

<p>In linear regression we attempt to express our dependent variable (in this case, housing price), as a linear combination of the independent variables (bathrooms and square footage) plus some constant.</p>

<p><strong><center>f(x,y) = ax + by + c</center></strong></p>

<p>For any given triplet of datapoints (square footage, number of bathrooms, and price), the difference between the actual price and the price predicted by our equation, squared is the pointwise error. In order to determine the values of a, b, and c that make the most sense, we choose the values that minimize the total average squared error. If the data can be expressed as an matrix X such that X<sup>T</sup>X is invertible, there is an easy formula to get the right values:</p>

<p><strong><center>w = (X<sup>T</sup>X)<sup>-1</sup>X<sup>T</sup>b</center></strong></p>

<p>where w is the matrix containing the coefficients <code>a</code>, <code>b</code>, and <code>c</code>, <code>X</code> represents the dependent variable matrix, and <code>b</code> represents the independent variable matrix.</p>

<p>With the Ruby matrix class these manipulations will be easy. Creating matrices in Ruby is simple. First add a line to require the matrix library, and you&rsquo;re ready to get started. Ruby stores each matrix as an array of rows. Just like arrays, the indices of matrix rows and columns start at zero. Don&rsquo;t forget that all the rows must be the same length for the matrix to be valid.</p>

<p>Here we enter the data from the table into two matrices. Matrices can be instantiated in a variety of ways. I chose to simply list out the rows as nested arrays, and unless specified otherwise that&rsquo;s what Ruby assumes the input will be. Each row represents a house with square footage in column 1 (the second column since ruby indexes columns from 0) and the number of bathrooms in column 2. The constant value in column 0 is necessary for the calculation of the constant c from our previous equation. The second matrix contains the housing prices. These two matrices are all we need for our calculations.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>require 'matrix'
</span><span class='line'>
</span><span class='line'>housing_data = Matrix[[1,4000,3], 
</span><span class='line'>                      [1,3000,2], 
</span><span class='line'>                      [1,3800,3], 
</span><span class='line'>                      [1,3200,2], 
</span><span class='line'>                      [1,3542,4], 
</span><span class='line'>                      [1,2348,2],
</span><span class='line'>                      [1,2987,3],
</span><span class='line'>                      [1,4300,4],
</span><span class='line'>                      [1,3342,4],
</span><span class='line'>                      [1,3000,3]
</span><span class='line'>                      ]
</span><span class='line'>
</span><span class='line'>housing_prices = Matrix[[400000],
</span><span class='line'>                      [310000],
</span><span class='line'>                      [375000],
</span><span class='line'>                      [315000],
</span><span class='line'>                      [350000],
</span><span class='line'>                      [250000],
</span><span class='line'>                      [300000],
</span><span class='line'>                      [450000],
</span><span class='line'>                      [360000],
</span><span class='line'>                      [320000]
</span><span class='line'>                      ]</span></code></pre></td></tr></table></div></figure>


<p> So, to get started on our handy equation, let&rsquo;s transpose <code>X</code>, our housing data matrix. Ruby has a useful function that will transpose a matrix for you, as you can see above.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">x_t</span> <span class="o">=</span> <span class="n">housing_data</span><span class="o">.</span><span class="n">transpose</span>
</span><span class='line'>
</span><span class='line'> <span class="o">=&gt;</span> <span class="no">Matrix</span><span class="o">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'>          <span class="o">[</span><span class="mi">4000</span><span class="p">,</span> <span class="mi">3000</span><span class="p">,</span> <span class="mi">3800</span><span class="p">,</span> <span class="mi">3200</span><span class="p">,</span> <span class="mi">3542</span><span class="p">,</span> <span class="mi">2348</span><span class="p">,</span> <span class="mi">2987</span><span class="p">,</span> <span class="mi">4300</span><span class="p">,</span> <span class="mi">3342</span><span class="p">,</span> <span class="mi">3000</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'>          <span class="o">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="o">]]</span>
</span></code></pre></td></tr></table></div></figure>


<p> Next we multiply the trasposed matrix by the original housing data matrix. The standard operators of <code>*, +, -, /,</code> and <code>**</code> perform the corresponding operations on matrices.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="n">x_t_x</span> <span class="o">=</span> <span class="n">x_t</span> <span class="o">*</span> <span class="n">housing_data</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">=&gt;</span> <span class="no">Matrix</span><span class="o">[[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">33519</span><span class="p">,</span> <span class="mi">30</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'>              <span class="o">[</span><span class="mi">33519</span><span class="p">,</span> <span class="mi">115320001</span><span class="p">,</span> <span class="mi">103193</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'>              <span class="o">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">103193</span><span class="p">,</span> <span class="mi">96</span><span class="o">]]</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can invert the resulting matrix using the inverse method.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="n">x_t_x</span><span class="o">.</span><span class="n">inverse</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">=&gt;</span> <span class="no">Matrix</span><span class="o">[[</span><span class="p">(</span><span class="mi">421924847</span><span class="o">/</span><span class="mi">108574934</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">61017</span><span class="o">/</span><span class="mi">54287467</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">673863</span><span class="o">/</span><span class="mi">108574934</span><span class="p">)</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'>            <span class="o">[</span><span class="p">(</span><span class="o">-</span><span class="mi">61017</span><span class="o">/</span><span class="mi">54287467</span><span class="p">),</span> <span class="p">(</span><span class="mi">30</span><span class="o">/</span><span class="mi">54287467</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">13180</span><span class="o">/</span><span class="mi">54287467</span><span class="p">)</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'>            <span class="o">[</span><span class="p">(</span><span class="o">-</span><span class="mi">673863</span><span class="o">/</span><span class="mi">108574934</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">13180</span><span class="o">/</span><span class="mi">54287467</span><span class="p">),</span> <span class="p">(</span><span class="mi">29676649</span><span class="o">/</span><span class="mi">108574934</span><span class="p">)</span><span class="o">]]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Finally, we can get the coefficients matrix with two more multiplication operations. Those fractions look pretty unwieldy, so let&rsquo;s iterate through the matrix and change them to floating point numbers to get a better idea of what&rsquo;s going on.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">w</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_t_x</span><span class="o">.</span><span class="n">inverse</span> <span class="o">*</span> <span class="n">x_t</span><span class="p">)</span> <span class="o">*</span> <span class="n">housing_prices</span>
</span><span class='line'>
</span><span class='line'> <span class="o">=&gt;</span> <span class="no">Matrix</span><span class="o">[[</span><span class="p">(</span><span class="mi">1018615352500</span><span class="o">/</span><span class="mi">54287467</span><span class="p">)</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'>          <span class="o">[</span><span class="p">(</span><span class="mi">4850790000</span><span class="o">/</span><span class="mi">54287467</span><span class="p">)</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'>          <span class="o">[</span><span class="p">(</span><span class="mi">447540942500</span><span class="o">/</span><span class="mi">54287467</span><span class="p">)</span><span class="o">]]</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>Matrix.each</code> reads left to right, then down the rows by default, but you can also specify options, for instance only reading down the diagonal (<code>row index == column index</code>). Since here we only have a simple [3x1] matrix, the default method works just fine. Rather than initializing and returning a new matrix, we can also just use the <code>collect</code> method in place of <code>each</code> to return the new matrix automatically.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">w</span><span class="o">.</span><span class="n">collect</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
</span><span class='line'>  <span class="n">i</span><span class="o">.</span><span class="n">to_f</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="o">=&gt;</span> <span class="no">Matrix</span><span class="o">[[</span><span class="mi">18763</span><span class="o">.</span><span class="mi">36</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'>          <span class="o">[</span><span class="mi">89</span><span class="o">.</span><span class="mi">35</span><span class="o">]</span><span class="p">,</span>
</span><span class='line'>          <span class="o">[</span><span class="mi">8243</span><span class="o">.</span><span class="mi">91</span><span class="o">]]</span>
</span></code></pre></td></tr></table></div></figure>


<p>And there we have the coefficients in a matrix. The constant, c, is in row 0, the square footage coefficient, b, is in row 1, and the bathroom coeffient, a, is in row 2 (note that this mirrors the column structure of the original data matrix). As we would expect, both a and b are positive since higher square footage and more bathrooms are both associated with a higher price. Additionally, the magnitude of the coefficient for square footage (row 1) is much smaller than the one for bathrooms, since square footage is a much bigger number than bathroom count. Let&rsquo;s revisit our original example of a 3500 square foot house with 3 bathrooms and determine the predicted price.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="mi">8243</span><span class="o">.</span><span class="mi">91</span><span class="o">*</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">89</span><span class="o">.</span><span class="mi">35</span><span class="o">*</span><span class="mi">3500</span> <span class="o">+</span> <span class="mi">18763</span><span class="o">.</span><span class="mi">36</span>
</span><span class='line'>
</span><span class='line'> <span class="o">=&gt;</span> <span class="mi">356220</span><span class="o">.</span><span class="mi">08999999997</span>
</span></code></pre></td></tr></table></div></figure>


<p>Our equation predicts that this house would sell for $356,220, which makes sense compared to the other points in our data set.</p>

<p>For more information on using matrices in Ruby checkout the <a href="http://www.ruby-doc.org/stdlib-2.0/libdoc/matrix/rdoc/Matrix.html">Ruby Documentation</a> and this <a href="http://rubylearning.com/blog/2013/04/04/ruby-matrix-the-forgotten-library/">helpful post</a> from RubyLearning Blog.</p>
]]></content>
  </entry>
  
</feed>
